.uk-container-center.uk-width-large-2-3.lane{:style => "background-color: #FFF;"}
  %h1 Отправка показаний счетчиков
  .uk-alert{"data-uk-alert"=>""}
    %a.uk-alert-close.uk-close
    %p
      %div
        На этой странице вы можете ввести показания счетчиков и передать их по ранее определенным каналам передачи.
        Для этого:
        %ul
          %li Введите показания в форме, расположенной рядом с названием счетчика
          %li
            %div
              Протестируйте, отправляемое сообщение, с помошью кнопки
              %code тест
          %li Отправьте показания счетчиков в необходимый
  -@environment.each_with_index do |(h,v), i|
    .uk-placeholder{:style=>"background: rgba(250, 250, 250, 0.90);"}
      #home
        //.uk-cover-background{:style=>"background-image: url('/img/house.png'); min-height: 200px; margin: 50px;"}
        //%img.uk-invisible{:src=>"", :width=>"", :height=>"", :alt=>""}
        %h2 Помещение #{i+1}
        #home
          %dl.uk-description-list-horizontal
            %dt Наименование
            %dd #{h.title}
            %dt Адрес
            %dd #{h.address}
        .uk-grid
          .uk-width-large-1-2
            #counters
              %table.uk-width-1-1
                %thead
                  %tr
                    %th{:width=>"50%"} Счетчик
                    %th{:width=>"50%"}
                      Показания за
                      =Russian::strftime(DateTime.now, "%B")
                -@environment[h][:counters].each_with_index do |c, ci|
                  %tr
                    //.uk-placeholder{:style=>"background: rgba(250, 250, 250, 0.90); padding: 20px;"}
                    %td{:style=>"padding: 5px;"}
                      .uk-badge
                        #{c.title} (#{c.typestr})
                      //%img{:src=>'/img/meter.png', :width=>32, :hight=>32}
                    %td{:style=>"padding: 5px;"}
                      %text.countervalue{"data-pk"=>ci+1, "data-url"=>"/home/#{i+1}/counter/#{ci+1}/setvalue"}
                        #{c.currentindication}
          .uk-width-large-1-2
            #channels
              %table.uk-width-1-1
                %thead
                  %tr
                    %th.uk-text-center{:width=>"50%"} Канал передачи
                    %th.uk-text-center{:width=>"50%"} Действие
                  -@environment[h][:channels].each_with_index do |ch, chi|
                    %tr
                      %td{:style=>"padding: 5px;"}
                        .uk-badge.uk-badge-success #{ch.title}
                      %td{:style=>"padding: 5px;"}
                        .uk-text-center
                          %a.uk-button.uk-button
                            Тест
                          %a.uk-button.uk-button-primary
                            Отправить


  -#
    -@environment.each_with_index do |(h,v), i|
    .uk-placeholder
      %h4
        Помещение #{i+1}
        %a{:href=>"/home/#{i+1}/delete", "data-uk-tooltip"=>"", :title=>"Удалить помещение"}
          %i.uk-icon-minus-circle
        %a{:href=>"/home/new", "data-uk-tooltip"=>"", :title=>"Добавить новое помещение"}
          %i.uk-icon-plus-circle
      %dl.uk-description-list-horizontal
        %dt.uk-margin-bottom Наименование
        %dd.uk-margin-bottom
          %text.hometitle{"data-pk"=>i+1} #{h.title}
        %dt.uk-margin-bottom Адрес
        %dd
          %text.homeaddress{"data-pk"=>i+1} #{h.address}
      .uk-panel.uk-panel-box
        .uk-panel-title
          Счетчики
          %a{:href=>"/home/#{i+1}/counter/new", "data-uk-tooltip"=>"", :title=>"Добавить новый счетчик"}
            %i.uk-icon-plus-circle
        -if @environment[h][:counters].size > 0
          %table.uk-table
            %thead
              %tr
                %th{:width=>"34%"} Наименование
                %th{:width=>"33%"} Тип счетчика
                %th{:width=>"33%"} Лицевой счет
            -@environment[h][:counters].each_with_index do |c, ci|
              %tr
                %td
                  %text.countertitle{"data-pk"=>ci+1, "data-url"=>"/home/#{i+1}/countertitleupdate"} #{c.title}
                  %a{:href=>"/home/#{i+1}/counter/#{ci+1}/delete", "data-uk-tooltip"=>"", :title=>"Удалить счетчик"}
                    %i.uk-icon-minus-circle
                %td
                  %text.countertype{"data-pk"=>ci+1, "data-value"=>c.type, "data-url"=>"/home/#{i+1}/countertypeupdate"}
                    //%option{:value=>c.type} #{c.typestr}
                %td
                  %text.counteraccount{"data-pk"=>ci+1, "data-url"=>"/home/#{i+1}/counteraccountupdate"} #{c.account}
        -else
          .uk-alert.uk-alert-warning Счетчики не определены
      .uk-panel.uk-panel-box.uk-margin-top
        .uk-panel-title
          Каналы передачи значений счетчиков
          %a{:href=>"/home/#{i+1}/channel/new", "data-uk-tooltip"=>"", :title=>"Добавить новый канал передачи"}
            %i.uk-icon-plus-circle
        -if @environment[h][:channels].size > 0
          %table.uk-table
            %thead
              %tr
                %th{:width=>"25%"} Наименование
                %th{:width=>"17%"} Способ передачи
                %th{:width=>"25%"} Получатель
                %th{:width=>"33%"} Шаблон передаваемого сообщения
            -@environment[h][:channels].each_with_index do |ch, chi|
              %tr
                %td
                  %text.channeltitle{"data-pk"=>chi+1, "data-url"=>"/home/#{i+1}/channeltitleupdate"} #{ch.title}
                  %a{:href=>"/home/#{i+1}/channel/#{chi+1}/delete", "data-uk-tooltip"=>"", :title=>"Удалить канал передачи"}
                    %i.uk-icon-minus-circle
                %td
                  %span
                    #{ch.type}
                    -if ch.type == 'sms' && @account.type != 1
                      .uk-badge.uk-badge-warning{"data-uk-tooltip"=>"", :title=>"Канал неактивен до покупки полного функционала"} !
                %td
                  %text.channelto{"data-pk"=>chi+1, "data-url"=>"/home/#{i+1}/channelreceiverupdate"} #{ch.to}
                %td
                  %code #{ch.pattern}
        -else
          .uk-alert.uk-alert-warning Каналы передачи не определены

:javascript
  $(function() {

    $.fn.editable.defaults.mode = 'inline';

    $('.countervalue').editable({
      type: 'text',
      emptytext: 'показания не введены',
      send: 'always',
      highlight: '#40e0d0',
      error: function(response, newValue) {
        if(response.status === 500) {
          return 'Сервис временно недоступен, пожалуйста повторте попытку позже.';
        }
      },
      success: function(response, newValue) {
        if(!response.success) {
          return response.msg
        } else {
          displaynotify(response.msg);
        } 
      }
    });

  });